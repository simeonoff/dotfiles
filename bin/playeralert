#!/bin/bash
# Arbitrary but unique message id
msgId="991049"

# NON COMPOSED COVER TEMPORARY PATH
NON_RESIZED_COVER="/tmp/SPOTIFY_NON_RESIZED_COVER.png"

# COMPOSED COVER TEMPORARY PATH
RESIZED_COVER="/tmp/SPOTIFY_RESIZED_COVER.png"

# COVER BACKGROUND
BACKGROUND="/usr/share/icons/Notifications/Notifications.png"

# COMPOSED COVER
COMPOSED_COVER="/usr/share/icons/Notifications/Spotify.png"

ARTIST_NAME=""
ORIGINAL_COVER=""

while :
do
    NEW_ARTIST_NAME=$(playerctl metadata xesam:title)

    if [ "$NEW_ARTIST_NAME" != "$ARTIST_NAME" ]
    then
        COVER=$(playerctl metadata mpris:artUrl)

        ARTIST_NAME="$NEW_ARTIST_NAME"
        ORIGINAL_COVER="$COVER"

        wget -4 -O "$NON_RESIZED_COVER" $COVER
        convert "$NON_RESIZED_COVER" -quality 100 -resize 48x48 "$RESIZED_COVER"
        dunstify -r "$msgId" -i "$RESIZED_COVER" -t 2000 "$(playerctl metadata xesam:artist)" "$(playerctl metadata xesam:title)"
    fi
    sleep 0.1
done
